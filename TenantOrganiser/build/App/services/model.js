define(["config"],function(e){function n(e){e.registerEntityTypeCtor("User",null,c),e.registerEntityTypeCtor("CommunalMessage",null,s),e.registerEntityTypeCtor("ActivityLog",null,l),e.registerEntityTypeCtor("Conversation",null,i),e.registerEntityTypeCtor("BillType",null,o),e.registerEntityTypeCtor("BillInvoice",null,r),e.registerEntityTypeCtor("InvoiceRecipient",null,t),e.registerEntityTypeCtor("UserSettings",null,u),e.registerEntityTypeCtor("BinRota",null,d),e.registerEntityTypeCtor("CleaningRota",null,p)}function t(e){e.PrettyAmount=ko.computed(function(){return"Â£"+e.Amount().toFixed(2)})}function r(e){e.PrettyDueDate=ko.computed(function(){return moment(e.DueDate().toString()).format("MMMM Do YYYY").toString()})}function o(e){e.currentInvoice=ko.observable(a(e))}function a(e){if(!e.BillInvoices())return null;var n=moment("26/03/1992","DD/MM/YYYY"),t=$.grep(e.BillInvoices(),function(e){var t=Math.abs(moment(e.DueDate()).diff(moment(),"days")),r=Math.abs(moment(n).diff(moment(),"days")),o=r>t?!0:!1;return n=r>t?e.DueDate():n,o});return t[t.length-1]}function i(e){e.RecipientsString=ko.computed({read:function(){if(!e.ConversationUsers())return"";switch(e.ConversationUsers().length){case 0:return"";case 1:return e.ConversationUsers()[0].User().FirstName();case 2:return e.ConversationUsers()[0].User().FirstName()+", "+e.ConversationUsers()[1].User().FirstName()+":";default:return e.ConversationUsers()[0].User().FirstName()+", "+e.ConversationUsers()[1].User().FirstName()+", "+(e.ConversationUsers().length-2)+" others:"}},deferEvaluation:!0})}function s(e){e.TimeElapsed=ko.computed(function(){return moment.utc(e.SentDate()).fromNow()}),e.DisplayMessage=ko.computed({read:function(){return e.User()?e.Content()+" -- "+e.User().FirstName()+" "+e.User().LastName():e.Content()},deferEvaluation:!0})}function l(e){e.TimeElapsed=ko.computed(function(){return moment.utc(e.Date()).fromNow()}),e.DisplayMessage=ko.computed({read:function(){return e.User().FirstName()+" "+e.User().LastName()+" "+e.ActionMessage()},deferEvaluation:!0}),e.Icon=ko.computed(function(){var n="glyphicon glyphicon-tag";switch(e.LogName()){case"Bill":return"glyphicon glyphicon-gbp";case"Wish List":return"glyphicon glyphicon-heart";case"Bin Rota":return"glyphicon glyphicon-trash";case"Cleaning Rota":return"glyphicon glyphicon-list";case"House":return"glyphicon glyphicon-home";case"Tenant":return"glyphicon glyphicon-user";case"Message":return"glyphicon glyphicon-envelope"}return n})}function c(n){n.FullName=ko.computed(function(){return n.FirstName()+" "+n.LastName()}),n.DisplayPictureFilePath=ko.computed(function(){return n.DisplayPictureFileName()?e.profilePicturesDirectory+n.DisplayPictureFileName():e.profilePicturesDirectory+e.genericProfilePictureFileName})}function u(e){e.PrettyBinRotaGroup=ko.computed(function(){return e.BinCollectionRotaGroup()?"Group "+e.BinCollectionRotaGroup():"No Group"}),e.PrettyCleaningRotaGroup=ko.computed(function(){return e.CleaningRotaGroup()?"Group "+e.CleaningRotaGroup():"No Group"})}function d(e){e.OccuranceDays=ko.computed({read:function(){switch(e.Occurance()){case"Daily":return 1;case"Weekly":return 7;case"Fortnightly":return 14;case"Monthly":return}},write:function(e){switch(e){case 1:return"Daily";case 7:return"Weekly";case 14:return"Fortnightly"}}}),e.PrettyStartDate=ko.computed({read:function(){return moment(e.StartDate()).format("DD/MM/YYYY").toString()},write:function(n){e.StartDate(moment(n,"DD/MM/YYYY").toString())}})}function p(e){e.OccuranceDays=ko.computed({read:function(){switch(e.Occurance()){case"Daily":return 1;case"Weekly":return 7;case"Fortnightly":return 14;case"Monthly":return}},write:function(e){switch(e){case 1:return"Daily";case 7:return"Weekly";case 14:return"Fortnightly"}}}),e.PrettyStartDate=ko.computed({read:function(){return moment(e.StartDate()).format("DD/MM/YYYY").toString()},write:function(n){e.StartDate(moment(n,"DD/MM/YYYY").toString())}})}var v={configureMetadataStore:n,userInitializer:c,getNextBill:a};return v});
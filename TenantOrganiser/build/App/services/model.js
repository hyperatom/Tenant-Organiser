define(["config"],function(e){function t(e){e.registerEntityTypeCtor("User",null,c),e.registerEntityTypeCtor("CommunalMessage",null,s),e.registerEntityTypeCtor("ActivityLog",null,l),e.registerEntityTypeCtor("Conversation",null,a),e.registerEntityTypeCtor("BillType",null,i),e.registerEntityTypeCtor("BillInvoice",null,r),e.registerEntityTypeCtor("InvoiceRecipient",null,n),e.registerEntityTypeCtor("UserSettings",null,u),e.registerEntityTypeCtor("BinRota",null,d),e.registerEntityTypeCtor("CleaningRota",null,p)}function n(e){e.PrettyAmount=ko.computed(function(){return"Â£"+e.Amount().toFixed(2)})}function r(e){e.PrettyDueDate=ko.computed(function(){return moment(e.DueDate().toString()).format("MMMM Do YYYY").toString()})}function i(e){e.currentInvoice=ko.observable(o(e))}function o(e){if(!e.BillInvoices())return null;var t=moment("26/03/1992","DD/MM/YYYY"),n=$.grep(e.BillInvoices(),function(e){var n=Math.abs(moment(e.DueDate()).diff(moment(),"days")),r=Math.abs(moment(t).diff(moment(),"days")),i=r>n?!0:!1;return t=r>n?e.DueDate():t,i});return n[n.length-1]}function a(e){e.RecipientsString=ko.computed({read:function(){if(!e.ConversationUsers())return"";switch(e.ConversationUsers().length){case 0:return"";case 1:return e.ConversationUsers()[0].User().FirstName();case 2:return e.ConversationUsers()[0].User().FirstName()+", "+e.ConversationUsers()[1].User().FirstName()+":";default:return e.ConversationUsers()[0].User().FirstName()+", "+e.ConversationUsers()[1].User().FirstName()+", "+(e.ConversationUsers().length-2)+" others:"}},deferEvaluation:!0})}function s(e){e.TimeElapsed=ko.computed(function(){return moment.utc(e.SentDate()).fromNow()}),e.DisplayMessage=ko.computed({read:function(){return e.User()?e.Content()+" -- "+e.User().FirstName()+" "+e.User().LastName():e.Content()},deferEvaluation:!0})}function l(e){e.TimeElapsed=ko.computed(function(){return moment.utc(e.Date()).fromNow()}),e.DisplayMessage=ko.computed({read:function(){return e.User().FirstName()+" "+e.User().LastName()+" "+e.ActionMessage()},deferEvaluation:!0}),e.Icon=ko.computed(function(){var t="glyphicon glyphicon-tag";switch(e.LogName()){case"Bill":return"glyphicon glyphicon-gbp";case"Wish List":return"glyphicon glyphicon-heart";case"Bin Rota":return"glyphicon glyphicon-trash";case"Cleaning Rota":return"glyphicon glyphicon-list";case"House":return"glyphicon glyphicon-home";case"Tenant":return"glyphicon glyphicon-user";case"Message":return"glyphicon glyphicon-envelope"}return t})}function c(t){t.FullName=ko.computed(function(){return t.FirstName()+" "+t.LastName()}),t.DisplayPictureFilePath=ko.computed(function(){return t.DisplayPictureFileName()?e.profilePicturesDirectory+t.DisplayPictureFileName():e.profilePicturesDirectory+e.genericProfilePictureFileName})}function u(e){e.PrettyBinRotaGroup=ko.computed(function(){return e.BinCollectionRotaGroup()?"Group "+e.BinCollectionRotaGroup():"No Group"}),e.PrettyCleaningRotaGroup=ko.computed(function(){return e.CleaningRotaGroup()?"Group "+e.CleaningRotaGroup():"No Group"})}function d(e){e.OccuranceDays=ko.computed({read:function(){switch(e.Occurance()){case"Daily":return 1;case"Weekly":return 7;case"Fortnightly":return 14;case"Monthly":return}},write:function(e){switch(e){case 1:return"Daily";case 7:return"Weekly";case 14:return"Fortnightly"}}}),e.PrettyStartDate=ko.computed({read:function(){return moment(e.StartDate()).format("DD/MM/YYYY").toString()},write:function(t){e.StartDate(moment(t,"DD/MM/YYYY").toString())}})}function p(e){e.OccuranceDays=ko.computed({read:function(){switch(e.Occurance()){case"Daily":return 1;case"Weekly":return 7;case"Fortnightly":return 14;case"Monthly":return}},write:function(e){switch(e){case 1:return"Daily";case 7:return"Weekly";case 14:return"Fortnightly"}}}),e.PrettyStartDate=ko.computed({read:function(){return moment(e.StartDate()).format("DD/MM/YYYY").toString()},write:function(t){e.StartDate(moment(t,"DD/MM/YYYY").toString())}})}var f={configureMetadataStore:t,userInitializer:c,getNextBill:o};return f});
define(["services/logger","services/datacontext","services/session"],function(e,n,t){function r(){return Q.all([o(),a()]).then(function(){m(v().slice()),y(f()),w(p().slice()),e.log("Edit Bin Rota View Activated",null,"edit-bin-rota",!0)})}function o(){return n.getTenants(b,t.sessionUser().HouseId())}function a(){return n.getCleaningRotasByHouse(h,t.sessionUser().HouseId())}function i(){$(".input-group.date").datepicker({autoclose:!0,todayHighlight:!0})}function s(){return n.saveChanges().then(function(){e.logSuccess("Bin Types Saved!",null,"edit-cleaning-rota",!0)})}function l(){n.rejectChanges(),a(),i(),e.log("Communal Areas Reset!",null,"edit-cleaning-rota",!0)}function c(e,n){n.Occurance(e.Name)}function u(e){e.entityAspect.setDeleted(),h.remove(e)}function d(){if(!y().Name())return e.logError("An area name is required.",null,"edit-cleaning-rota",!0),void 0;if(!y().PrettyStartDate())return e.logError("A rota start date is required.",null,"edit-cleaning-rota",!0),void 0;var r=n.createCleaningRota(t.sessionUser().House());r.Name(y().Name()),r.Occurance(y().Occurance()),r.PrettyStartDate(y().PrettyStartDate()),h.push(r),y(f()),i()}function p(){var e=new ko.observableArray;return e.push({Name:"Daily"}),e.push({Name:"Weekly"}),e.push({Name:"Fortnightly"}),e.push({Name:"Monthly"}),e}function v(){var e=new ko.observableArray([{Id:null,Name:"No Group"}]);return $.each(b(),function(n){e.push({Id:n+1,Name:"Group "+(n+1)})}),e}function f(){return data={Name:new ko.observable(""),Occurance:new ko.observable("Weekly"),PrettyStartDate:new ko.observable("")}}function g(t,r){return r.UserSettings().CleaningRotaGroup(t.Id),n.saveChanges().then(function(){e.logSuccess("Group Change Saved!",null,"edit-cleaning-rota",!0)})}var b=new ko.observableArray,m=new ko.observableArray,h=new ko.observableArray,y=new ko.observable,w=new ko.observableArray,k={activate:r,title:"Edit Cleaning Rota",attached:i,hasChanges:n.hasChanges,tenants:b,rotaGroups:m,occuranceOptions:w,communalAreas:h,newAreaType:y,groupOptionClicked:g,occuranceOptionsClicked:c,deleteAreaClicked:u,addAreaClicked:d,saveAreasClicked:s,undoAreasClicked:l};return k});
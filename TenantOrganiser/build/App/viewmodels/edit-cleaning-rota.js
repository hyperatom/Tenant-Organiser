define(["services/logger","services/datacontext","services/session"],function(e,t,n){function r(){return Q.all([i(),o()]).then(function(){m(f().slice()),y(h()),_(p().slice()),e.log("Edit Bin Rota View Activated",null,"edit-bin-rota",!0)})}function i(){return t.getTenants(v,n.sessionUser().HouseId())}function o(){return t.getCleaningRotasByHouse(b,n.sessionUser().HouseId())}function a(){$(".input-group.date").datepicker({autoclose:!0,todayHighlight:!0})}function s(){return t.saveChanges().then(function(){e.logSuccess("Bin Types Saved!",null,"edit-cleaning-rota",!0)})}function l(){t.rejectChanges(),o(),a(),e.log("Communal Areas Reset!",null,"edit-cleaning-rota",!0)}function c(e,t){t.Occurance(e.Name)}function u(e){e.entityAspect.setDeleted(),b.remove(e)}function d(){if(!y().Name())return e.logError("An area name is required.",null,"edit-cleaning-rota",!0),void 0;if(!y().PrettyStartDate())return e.logError("A rota start date is required.",null,"edit-cleaning-rota",!0),void 0;var r=t.createCleaningRota(n.sessionUser().House());r.Name(y().Name()),r.Occurance(y().Occurance()),r.PrettyStartDate(y().PrettyStartDate()),b.push(r),y(h()),a()}function p(){var e=new ko.observableArray;return e.push({Name:"Daily"}),e.push({Name:"Weekly"}),e.push({Name:"Fortnightly"}),e.push({Name:"Monthly"}),e}function f(){var e=new ko.observableArray([{Id:null,Name:"No Group"}]);return $.each(v(),function(t){e.push({Id:t+1,Name:"Group "+(t+1)})}),e}function h(){return data={Name:new ko.observable(""),Occurance:new ko.observable("Weekly"),PrettyStartDate:new ko.observable("")}}function g(n,r){return r.UserSettings().CleaningRotaGroup(n.Id),t.saveChanges().then(function(){e.logSuccess("Group Change Saved!",null,"edit-cleaning-rota",!0)})}var v=new ko.observableArray,m=new ko.observableArray,b=new ko.observableArray,y=new ko.observable,_=new ko.observableArray,w={activate:r,title:"Edit Cleaning Rota",attached:a,hasChanges:t.hasChanges,tenants:v,rotaGroups:m,occuranceOptions:_,communalAreas:b,newAreaType:y,groupOptionClicked:g,occuranceOptionsClicked:c,deleteAreaClicked:u,addAreaClicked:d,saveAreasClicked:s,undoAreasClicked:l};return w});
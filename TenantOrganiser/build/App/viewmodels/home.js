define(["services/logger","services/datacontext","services/session","plugins/router"],function(e,n,t){function r(){return u(t.sessionUser().House().HouseName),Q.all([a(),i()]).then(function(){e.log("Home View Activated",null,"home",!0)})}function o(){$("#message-box").keypress(l)}function a(){return n.getAnnouncements(d,t.sessionUser().HouseId())}function i(){return n.getActivitiyLogs(p,t.sessionUser().HouseId())}function s(e){var t=e;return d.remove(e),n.deleteCommunalMessage(t).then(a)}function l(e){var n=e.keyCode?e.keyCode:e.which;"13"==n&&c()}function c(){if(!v())return e.logError("Message cannot be empty.",null,"home",!0),void 0;var r=n.createAnnouncement();return r.Content(v()),r.SentDate(moment().toString()),r.User(t.sessionUser()),r.House(t.sessionUser().House()),n.saveChanges().then(function(){v("")}).then(a)}var u=ko.observable(),d=ko.observableArray(),p=ko.observableArray(),v=ko.observable(),f={activate:r,attached:o,title:"Home",activityFeed:p,messageFeed:d,messageInput:v,addMessage:c,deleteMessage:s,houseName:u};return f});
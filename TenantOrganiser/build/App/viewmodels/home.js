define(["services/logger","services/datacontext","services/session","plugins/router"],function(e,t,n){function r(){return u(n.sessionUser().House().HouseName),Q.all([o(),a()]).then(function(){e.log("Home View Activated",null,"home",!0)})}function i(){$("#message-box").keypress(l)}function o(){return t.getAnnouncements(d,n.sessionUser().HouseId())}function a(){return t.getActivitiyLogs(p,n.sessionUser().HouseId())}function s(e){var n=e;return d.remove(e),t.deleteCommunalMessage(n).then(o)}function l(e){var t=e.keyCode?e.keyCode:e.which;"13"==t&&c()}function c(){if(!f())return e.logError("Message cannot be empty.",null,"home",!0),void 0;var r=t.createAnnouncement();return r.Content(f()),r.SentDate(moment().toString()),r.User(n.sessionUser()),r.House(n.sessionUser().House()),t.saveChanges().then(function(){f("")}).then(o)}var u=ko.observable(),d=ko.observableArray(),p=ko.observableArray(),f=ko.observable(),h={activate:r,attached:i,title:"Home",activityFeed:p,messageFeed:d,messageInput:f,addMessage:c,deleteMessage:s,houseName:u};return h});
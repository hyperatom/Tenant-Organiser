define(["services/logger","plugins/router"],function(e,n){function t(n){return 0==g?(u(m),d(f),g=!0):(b.removeAll(),w(""),y("")),h(n.billname),e.log("Add Bill Invoice Activated",null,"add-bill-invoice",!0),!0}function r(){ko.observable.fn.beforeAndAfterSubscribe=function(e,n){var t;n.subscribe(function(e){t=e},null,"beforeChange"),n.subscribe(function(r){e(n,t,r)})},$(".input-group.date").datepicker({autoclose:!0,todayHighlight:!0}),ko.observable.fn.beforeAndAfterSubscribe(s,y)}function o(){n.navigate("#bills"),e.logSuccess("Invoice Created!",null,"add-bill-invoice",!0)}function a(){ko.utils.arrayForEach(b(),function(){b.removeAll()}),y(0),w(""),e.log("Changes undone!",null,"add-bill-invoice",!0)}function i(){k=!0;var e=0;ko.utils.arrayForEach(b(),function(n){console.log(e+=parseInt(n.Amount()))}),0==C&&y(e),k=!1}function s(e,n,t){var r=b().length;if(n!=t&&""!=t&&r>0&&0==k){var o=t/r;console.log("yes"),C=!0,ko.utils.arrayForEach(b(),function(e){e.Amount(o)}),C=!1}}function l(){var e={GlyphClass:ko.observable(f().GlyphClass()),UserFullName:ko.observable(f().UserFullName()),Amount:ko.observable(f().Amount())};e.Amount.subscribe(i),b.push(e),e.Amount.notifySubscribers(),f().GlyphClass("glyphicon glyphicon-unchecked"),f().UserFullName("Select a recipient"),f().Amount("")}function c(e){b.remove(e),e.Amount.notifySubscribers()}function u(e){e.push({UserFullName:"Adam Barrell"}),e.push({UserFullName:"Joss Whittle"}),e.push({UserFullName:"Tom Milner"}),e.push({UserFullName:"Toby Webster"})}function d(e){e({GlyphClass:ko.observable("glyphicon glyphicon-unchecked"),UserFullName:ko.observable("Select a recipient"),Amount:ko.observable("")})}function p(e,n){console.log(e),n.UserFullName(e)}function v(n){console.log(n),"glyphicon glyphicon-unchecked"==n.GlyphClass()?(n.GlyphClass("glyphicon glyphicon-check"),e.logSuccess(n.UserFullName().concat(" has now paid."),null,"bills",!0)):"glyphicon glyphicon-check"==n.GlyphClass()&&(n.GlyphClass("glyphicon glyphicon-unchecked"),e.logSuccess(n.UserFullName().concat(" has now un-paid."),null,"bills",!0))}var g=!1,b=new ko.observableArray,f=new ko.observableArray,m=new ko.observableArray,h=new ko.observable(""),y=new ko.observable(0),w=new ko.observable("26 March '14"),k=!1,C=!1,x={activate:t,title:"Add Bill Invoice View",attached:r,billName:h,clickedCombo:p,checkboxClicked:v,invoiceRecipients:b,newInvoiceRecipient:f,totalAmount:y,dueDate:w,addNewRecipient:l,removeRecipient:c,invoiceCreated:o,invoiceUndone:a,tenantsList:m};return x});
define(["durandal/system","plugins/router","services/logger","services/datacontext","services/session"],function(e,n,t,r,o){function a(){return r.primeData().then(function(){return o.refreshSession()}).then(i)}function i(){return n.makeRelative({moduleId:"viewmodels"}),n.map([{route:"",moduleId:"home",nav:!0},{route:"home",moduleId:"home",nav:!0},{route:"account-settings",moduleId:"account-settings",nav:!0},{route:"add-bill-invoice/:billname",moduleId:"add-bill-invoice",nav:!0},{route:"edit-bill-invoice/:billname",moduleId:"edit-bill-invoice",nav:!0},{route:"bills",moduleId:"bills",nav:!0},{route:"edit-bin-rota",moduleId:"edit-bin-rota",nav:!0},{route:"edit-cleaning-rota",moduleId:"edit-cleaning-rota",nav:!0},{route:"login",moduleId:"login",nav:!0},{route:"messages",moduleId:"messages",nav:!0},{route:"new-message",moduleId:"new-message",nav:!0},{route:"tasks",moduleId:"tasks",nav:!0},{route:"tenants",moduleId:"tenants",nav:!0},{route:"wish-list",moduleId:"wish-list",nav:!0},{route:"join-house",moduleId:"join-house",nav:!0}]).buildNavigationModel().mapUnknownRoutes("home").activate()}n.guardRoute=function(e,n){var t=["login"],r=-1==$.inArray(n.fragment,t)?!1:!0;return r?!0:"join-house"===n.fragment?o.sessionUser().House()?"#home":!0:o.sessionUser()&&!o.sessionUser().House()?"#join-house":o.sessionUser()?!0:"#login"};var s={activate:a,router:n,sessionUser:o.sessionUser};return s});
define(["durandal/system","plugins/router","services/logger","services/datacontext","services/session"],function(e,t,n,r,i){function o(){return r.primeData().then(function(){return i.refreshSession()}).then(a)}function a(){return t.makeRelative({moduleId:"viewmodels"}),t.map([{route:"",moduleId:"home",nav:!0},{route:"home",moduleId:"home",nav:!0},{route:"account-settings",moduleId:"account-settings",nav:!0},{route:"add-bill-invoice/:billname",moduleId:"add-bill-invoice",nav:!0},{route:"edit-bill-invoice/:billname",moduleId:"edit-bill-invoice",nav:!0},{route:"bills",moduleId:"bills",nav:!0},{route:"edit-bin-rota",moduleId:"edit-bin-rota",nav:!0},{route:"edit-cleaning-rota",moduleId:"edit-cleaning-rota",nav:!0},{route:"login",moduleId:"login",nav:!0},{route:"messages",moduleId:"messages",nav:!0},{route:"new-message",moduleId:"new-message",nav:!0},{route:"tasks",moduleId:"tasks",nav:!0},{route:"tenants",moduleId:"tenants",nav:!0},{route:"wish-list",moduleId:"wish-list",nav:!0},{route:"join-house",moduleId:"join-house",nav:!0}]).buildNavigationModel().mapUnknownRoutes("home").activate()}t.guardRoute=function(e,t){var n=["login"],r=-1==$.inArray(t.fragment,n)?!1:!0;return r?!0:"join-house"===t.fragment?i.sessionUser().House()?"#home":!0:i.sessionUser()&&!i.sessionUser().House()?"#join-house":i.sessionUser()?!0:"#login"};var s={activate:o,router:t,sessionUser:i.sessionUser};return s});
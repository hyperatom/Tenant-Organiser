define(["services/logger","durandal/app","plugins/router","services/datacontext","services/session","services/model","./create-bill-modal"],function(e,n,t,r,o,a,i){function s(){return Q.all([l(),c()]).then(function(){e.log("Bills View Activated",null,"bills",!0)})}function l(){return r.getBillTypesByHouse(y,o.sessionUser().HouseId()).then(function(){$.each(y(),function(e,n){n.BillInvoices().sort(function(e,n){return e.DueDate()<n.DueDate()?-1:1}),n.currentInvoice(a.getNextBill(n))})})}function c(){return r.getTenants(k,o.sessionUser().HouseId())}function u(){i.show().then(function(e){return e?(console.log(e),l()):void 0})}function d(t){function o(n){if("Yes"===n){var o=t;return y.remove(t),o.entityAspect.setDeleted(),r.saveChanges().then(function(){e.logSuccess(o.Name().concat(" bill has been deleted."),null,"bills",!0)})}}return n.showMessage("Are you sure you want to delete this bill and all of its invoices?","Delete "+t.Name(),["Yes","No"]).then(o)}function p(e){t.navigate("#edit-bill-invoice/"+e.currentInvoice().Id())}function v(e){t.navigate("#add-bill-invoice/"+e.Id())}function f(n){return n.Paid()?(n.Paid(!1),r.saveChanges().then(function(){e.logSuccess(n.User().FullName().concat(" has now un-paid."),null,"bills",!0)})):(n.Paid(!0),r.saveChanges().then(function(){e.logSuccess(n.User().FullName().concat(" has now paid."),null,"bills",!0)}))}function g(e){var n=e.BillInvoices().indexOf(e.currentInvoice());e.currentInvoice(e.BillInvoices()[n-1])}function b(e){var n=e.BillInvoices().indexOf(e.currentInvoice());e.currentInvoice(e.BillInvoices()[n+1])}function m(e){return 0===e.BillInvoices().indexOf(e.currentInvoice())?!1:!0}function h(e){return e.BillInvoices().indexOf(e.currentInvoice())===e.BillInvoices().length-1?!1:!0}var y=new ko.observableArray,w=new ko.observableArray,k=new ko.observableArray,C={activate:s,title:"Bills View",bills:y,addBill:u,newBillType:w,tenantsList:k,navPreviousInvoice:g,navNextInvoice:b,isPreviousEnabled:m,isNextEnabled:h,checkboxClicked:f,deleteBill:d,navToAddInvoice:v,navToEditInvoice:p};return C});
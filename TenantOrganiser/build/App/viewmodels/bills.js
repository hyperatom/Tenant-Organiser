define(["services/logger","durandal/app","plugins/router","services/datacontext","services/session","services/model","./create-bill-modal"],function(e,t,n,r,i,o,a){function s(){return Q.all([l(),c()]).then(function(){e.log("Bills View Activated",null,"bills",!0)})}function l(){return r.getBillTypesByHouse(y,i.sessionUser().HouseId()).then(function(){$.each(y(),function(e,t){t.BillInvoices().sort(function(e,t){return e.DueDate()<t.DueDate()?-1:1}),t.currentInvoice(o.getNextBill(t))})})}function c(){return r.getTenants(w,i.sessionUser().HouseId())}function u(){a.show().then(function(e){return e?(console.log(e),l()):void 0})}function d(n){function i(t){if("Yes"===t){var i=n;return y.remove(n),i.entityAspect.setDeleted(),r.saveChanges().then(function(){e.logSuccess(i.Name().concat(" bill has been deleted."),null,"bills",!0)})}}return t.showMessage("Are you sure you want to delete this bill and all of its invoices?","Delete "+n.Name(),["Yes","No"]).then(i)}function p(e){n.navigate("#edit-bill-invoice/"+e.currentInvoice().Id())}function f(e){n.navigate("#add-bill-invoice/"+e.Id())}function h(t){return t.Paid()?(t.Paid(!1),r.saveChanges().then(function(){e.logSuccess(t.User().FullName().concat(" has now un-paid."),null,"bills",!0)})):(t.Paid(!0),r.saveChanges().then(function(){e.logSuccess(t.User().FullName().concat(" has now paid."),null,"bills",!0)}))}function g(e){var t=e.BillInvoices().indexOf(e.currentInvoice());e.currentInvoice(e.BillInvoices()[t-1])}function v(e){var t=e.BillInvoices().indexOf(e.currentInvoice());e.currentInvoice(e.BillInvoices()[t+1])}function m(e){return 0===e.BillInvoices().indexOf(e.currentInvoice())?!1:!0}function b(e){return e.BillInvoices().indexOf(e.currentInvoice())===e.BillInvoices().length-1?!1:!0}var y=new ko.observableArray,_=new ko.observableArray,w=new ko.observableArray,k={activate:s,title:"Bills View",bills:y,addBill:u,newBillType:_,tenantsList:w,navPreviousInvoice:g,navNextInvoice:v,isPreviousEnabled:m,isNextEnabled:b,checkboxClicked:h,deleteBill:d,navToAddInvoice:f,navToEditInvoice:p};return k});
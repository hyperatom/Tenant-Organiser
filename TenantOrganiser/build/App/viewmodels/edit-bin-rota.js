define(["services/logger","services/datacontext","services/session"],function(e,n,t){function r(){return Q.all([o(),a()]).then(function(){y(g().slice()),w(l().slice()),C(b()),x(f().slice()),e.log("Edit Bin Rota View Activated",null,"edit-bin-rota",!0)})}function o(){return n.getTenants(h,t.sessionUser().HouseId())}function a(){return n.getBinRotasByHouse(k,t.sessionUser().HouseId())}function i(){$(".input-group.date").datepicker({autoclose:!0,todayHighlight:!0})}function s(e,n){n.Colour(e.Name)}function l(){var e=new ko.observableArray;return e.push({Name:"black"}),e.push({Name:"red"}),e.push({Name:"green"}),e.push({Name:"pink"}),e.push({Name:"brown"}),e}function c(){return n.saveChanges().then(function(){e.logSuccess("Bin Types Saved!",null,"edit-bin-rota",!0)})}function u(){n.rejectChanges(),a(),i(),e.log("Bin Types Reset!",null,"edit-bin-rota",!0)}function d(e,n){n.Occurance(e.Name)}function p(e){e.entityAspect.setDeleted(),k.remove(e)}function v(){if(!C().Name())return e.logError("A bin name is required.",null,"edit-bin-rota",!0),void 0;if(!C().PrettyStartDate())return e.logError("A rota start date is required.",null,"edit-bin-rota",!0),void 0;var r=n.createBinRota(t.sessionUser().House());r.Name(C().Name()),r.Occurance(C().Occurance()),r.PrettyStartDate(C().PrettyStartDate()),r.Colour(C().Colour()),k.push(r),C(b()),i()}function f(){var e=new ko.observableArray;return e.push({Name:"Daily"}),e.push({Name:"Weekly"}),e.push({Name:"Fortnightly"}),e.push({Name:"Monthly"}),e}function g(){var e=new ko.observableArray([{Id:null,Name:"No Group"}]);return $.each(h(),function(n){e.push({Id:n+1,Name:"Group "+(n+1)})}),e}function b(){return data={Name:new ko.observable(""),Occurance:new ko.observable("Weekly"),PrettyStartDate:new ko.observable(""),Colour:new ko.observable("black")}}function m(t,r){return console.log(r),r.UserSettings().BinCollectionRotaGroup(t.Id),n.saveChanges().then(function(){e.logSuccess("Group Change Saved!",null,"edit-cleaning-rota",!0)})}var h=new ko.observableArray,y=new ko.observableArray,w=new ko.observableArray,k=new ko.observableArray,C=new ko.observable,x=new ko.observableArray,I={activate:r,title:"Edit Bin Rota",attached:i,hasChanges:n.hasChanges,tenants:h,rotaGroups:y,binColourOptions:w,binColourOptionsClicked:s,occuranceOptions:x,binTypes:k,newBinType:C,groupOptionClicked:m,occuranceOptionsClicked:d,deleteBinTypeClicked:p,addBinTypeClicked:v,saveBinTypesClicked:c,undoBinTypesClicked:u};return I});
define(["services/logger","services/datacontext","services/session"],function(e,t,n){function r(){return Q.all([i(),o()]).then(function(){y(g().slice()),w(l().slice()),k(v()),x(h().slice()),e.log("Edit Bin Rota View Activated",null,"edit-bin-rota",!0)})}function i(){return t.getTenants(m,n.sessionUser().HouseId())}function o(){return t.getBinRotasByHouse(_,n.sessionUser().HouseId())}function a(){$(".input-group.date").datepicker({autoclose:!0,todayHighlight:!0})}function s(e,t){t.Colour(e.Name)}function l(){var e=new ko.observableArray;return e.push({Name:"black"}),e.push({Name:"red"}),e.push({Name:"green"}),e.push({Name:"pink"}),e.push({Name:"brown"}),e}function c(){return t.saveChanges().then(function(){e.logSuccess("Bin Types Saved!",null,"edit-bin-rota",!0)})}function u(){t.rejectChanges(),o(),a(),e.log("Bin Types Reset!",null,"edit-bin-rota",!0)}function d(e,t){t.Occurance(e.Name)}function p(e){e.entityAspect.setDeleted(),_.remove(e)}function f(){if(!k().Name())return e.logError("A bin name is required.",null,"edit-bin-rota",!0),void 0;if(!k().PrettyStartDate())return e.logError("A rota start date is required.",null,"edit-bin-rota",!0),void 0;var r=t.createBinRota(n.sessionUser().House());r.Name(k().Name()),r.Occurance(k().Occurance()),r.PrettyStartDate(k().PrettyStartDate()),r.Colour(k().Colour()),_.push(r),k(v()),a()}function h(){var e=new ko.observableArray;return e.push({Name:"Daily"}),e.push({Name:"Weekly"}),e.push({Name:"Fortnightly"}),e.push({Name:"Monthly"}),e}function g(){var e=new ko.observableArray([{Id:null,Name:"No Group"}]);return $.each(m(),function(t){e.push({Id:t+1,Name:"Group "+(t+1)})}),e}function v(){return data={Name:new ko.observable(""),Occurance:new ko.observable("Weekly"),PrettyStartDate:new ko.observable(""),Colour:new ko.observable("black")}}function b(n,r){return console.log(r),r.UserSettings().BinCollectionRotaGroup(n.Id),t.saveChanges().then(function(){e.logSuccess("Group Change Saved!",null,"edit-cleaning-rota",!0)})}var m=new ko.observableArray,y=new ko.observableArray,w=new ko.observableArray,_=new ko.observableArray,k=new ko.observable,x=new ko.observableArray,C={activate:r,title:"Edit Bin Rota",attached:a,hasChanges:t.hasChanges,tenants:m,rotaGroups:y,binColourOptions:w,binColourOptionsClicked:s,occuranceOptions:x,binTypes:_,newBinType:k,groupOptionClicked:b,occuranceOptionsClicked:d,deleteBinTypeClicked:p,addBinTypeClicked:f,saveBinTypesClicked:c,undoBinTypesClicked:u};return C});
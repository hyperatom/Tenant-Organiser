define(["services/logger","services/datacontext","services/session"],function(e,t,n){function r(){return i().then(function(){e.log("Wish List View Activated",null,"wish-list",!0)})}function o(){$("#message-box").keypress(a)}function i(){return t.getWishListItems(u,n.sessionUser().House().Id())}function a(e){var t=e.keyCode?e.keyCode:e.which;"13"==t&&l()}function s(r){return r.UserAcquired()?(r.UserAcquiredId(null),r.AquiredOn(null),e.logSuccess("Item "+r.ItemName()+" Un-Purchased!",null,"wish-list",!0)):(r.UserAcquiredId(n.sessionUser().Id()),r.AquiredOn(moment().utc().toString()),e.logSuccess("Item "+r.ItemName()+" Purchased!",null,"wish-list",!0)),t.saveChanges().then(i)}function l(){if(!d())return e.logError("Item name must not be empty.",null,"wish-list",!0),void 0;var r=t.createWishListItem();return r.ItemName(d()),r.UserAddedId(n.sessionUser().Id()),r.HouseId(n.sessionUser().House().Id()),t.saveChanges().then(function(){e.logSuccess("Item "+d()+" Added!",null,"wish-list",!0),d("")}).then(i)}function c(e){return u.remove(e),e.entityAspect.setDeleted(),t.saveChanges().then(i)}var u=new ko.observableArray,d=new ko.observable,f={activate:r,title:"Wish List",attached:o,wishListItems:u,newItemName:d,wishListItemAdded:l,wishListItemRemoved:c,wishListItemPurchasedClicked:s};return f});
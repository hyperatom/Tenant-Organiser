define(["services/logger","plugins/router"],function(e,n){function t(n){f.removeAll(),d(m),p(h),g(f);var t=0;return ko.utils.arrayForEach(f(),function(e){t+=parseInt(e.Amount())}),w(t),y(n),e.log("Add Bill Invoice Activated",null,"edit-bill-invoice",!0),!0}function r(){ko.observable.fn.beforeAndAfterSubscribe=function(e,n){var t;n.subscribe(function(e){t=e},null,"beforeChange"),n.subscribe(function(r){e(n,t,r)})},$(".input-group.date").datepicker({autoclose:!0,todayHighlight:!0}),ko.observable.fn.beforeAndAfterSubscribe(l,w)}function o(){n.navigate("#bills"),e.logSuccess("Invoice Saved!",null,"edit-bill-invoice",!0)}function a(){n.navigate("#bills"),e.logSuccess("Invoice Deleted!",null,"edit-bill-invoice",!0)}function i(){f.removeAll(),g(f),k("28 March '14"),e.log("Changes undone!",null,"edit-bill-invoice",!0)}function s(){C=!0;var e=0;ko.utils.arrayForEach(f(),function(n){console.log(e+=parseInt(n.Amount()))}),0==A&&w(e),C=!1}function l(e,n,t){var r=f().length;if(n!=t&&""!=t&&r>0&&0==C){var o=t/r;console.log("yes"),A=!0,ko.utils.arrayForEach(f(),function(e){e.Amount(o)}),A=!1}}function c(){var e={GlyphClass:ko.observable(h().GlyphClass()),UserFullName:ko.observable(h().UserFullName()),Amount:ko.observable(h().Amount())};e.Amount.subscribe(s),f.push(e),e.Amount.notifySubscribers(),h().GlyphClass("glyphicon glyphicon-unchecked"),h().UserFullName("Select a recipient"),h().Amount("")}function u(e){f.remove(e),e.Amount.notifySubscribers()}function d(e){e.push({UserFullName:"Adam Barrell"}),e.push({UserFullName:"Joss Whittle"}),e.push({UserFullName:"Tom Milner"}),e.push({UserFullName:"Toby Webster"})}function p(e){e({GlyphClass:ko.observable("glyphicon glyphicon-unchecked"),UserFullName:ko.observable("Select a recipient"),Amount:ko.observable("")})}function v(e,n){console.log(e),n.UserFullName(e)}function b(n){console.log(n),"glyphicon glyphicon-unchecked"==n.GlyphClass()?(n.GlyphClass("glyphicon glyphicon-check"),e.logSuccess(n.UserFullName().concat(" has now paid."),null,"bills",!0)):"glyphicon glyphicon-check"==n.GlyphClass()&&(n.GlyphClass("glyphicon glyphicon-unchecked"),e.logSuccess(n.UserFullName().concat(" has now un-paid."),null,"bills",!0))}function g(e){e.push({GlyphClass:ko.observable("glyphicon glyphicon-unchecked"),UserFullName:ko.observable("Adam Barrell"),Amount:ko.observable("72")}),e.push({GlyphClass:ko.observable("glyphicon glyphicon-check"),UserFullName:ko.observable("Joss Whittle"),Amount:ko.observable("33")}),e.push({GlyphClass:ko.observable("glyphicon glyphicon-unchecked"),UserFullName:ko.observable("Toby Webster"),Amount:ko.observable("90")}),e.push({GlyphClass:ko.observable("glyphicon glyphicon-unchecked"),UserFullName:ko.observable("Tom Walton"),Amount:ko.observable("70")}),e.push({GlyphClass:ko.observable("glyphicon glyphicon-check"),UserFullName:ko.observable("Chris Lewis"),Amount:ko.observable("44")}),e()[0].Amount.subscribe(s),e()[1].Amount.subscribe(s),e()[2].Amount.subscribe(s),e()[3].Amount.subscribe(s),e()[4].Amount.subscribe(s),e()[0].Amount.notifySubscribers(),e()[1].Amount.notifySubscribers(),e()[2].Amount.notifySubscribers(),e()[3].Amount.notifySubscribers(),e()[4].Amount.notifySubscribers()}var f=new ko.observableArray,h=new ko.observableArray,m=new ko.observableArray,y=new ko.observable(""),w=new ko.observable(0),k=new ko.observable("26 March '14"),C=!1,A=!1,x={activate:t,title:"Add Bill Invoice View",attached:r,billName:y,clickedCombo:v,checkboxClicked:b,invoiceRecipients:f,newInvoiceRecipient:h,totalAmount:w,dueDate:k,addNewRecipient:c,removeRecipient:u,invoiceSaved:o,invoiceDeleted:a,invoiceUndone:i,tenantsList:m};return x});
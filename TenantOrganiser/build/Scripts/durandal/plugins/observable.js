define(["durandal/system","durandal/binder","knockout"],function(e,n,t){function r(e){var n=e[0];return"_"===n||"$"===n}function o(n){return!(!n||void 0===n.nodeType||!e.isNumber(n.nodeType))}function a(e){if(!e||o(e)||e.ko===t||e.jquery)return!1;var n=p.call(e);return-1==v.indexOf(n)&&!(e===!0||e===!1)}function i(e,n){var t=e.__observable__,r=!0;if(!t||!t.__full__){t=t||(e.__observable__={}),t.__full__=!0,f.forEach(function(t){e[t]=function(){r=!1;var e=m[t].apply(n,arguments);return r=!0,e}}),g.forEach(function(t){e[t]=function(){r&&n.valueWillMutate();var o=h[t].apply(e,arguments);return r&&n.valueHasMutated(),o}}),b.forEach(function(t){e[t]=function(){for(var o=0,a=arguments.length;a>o;o++)s(arguments[o]);r&&n.valueWillMutate();var i=h[t].apply(e,arguments);return r&&n.valueHasMutated(),i}}),e.splice=function(){for(var t=2,o=arguments.length;o>t;t++)s(arguments[t]);r&&n.valueWillMutate();var a=h.splice.apply(e,arguments);return r&&n.valueHasMutated(),a};for(var o=0,a=e.length;a>o;o++)s(e[o])}}function s(n){var o,s;if(a(n)&&(o=n.__observable__,!o||!o.__full__)){if(o=o||(n.__observable__={}),o.__full__=!0,e.isArray(n)){var l=t.observableArray(n);i(n,l)}else for(var u in n)r(u)||o[u]||(s=n[u],e.isFunction(s)||c(n,u,s));y&&e.log("Converted",n)}}function l(e,n,t){var r;e(n),r=e.peek(),t?r?r.destroyAll||i(r,e):(r=[],e(r),i(r,e)):s(r)}function c(n,r,o){var a,c,u=n.__observable__||(n.__observable__={});if(void 0===o&&(o=n[r]),e.isArray(o))a=t.observableArray(o),i(o,a),c=!0;else if("function"==typeof o){if(!t.isObservable(o))return null;a=o}else e.isPromise(o)?(a=t.observable(),o.then(function(n){if(e.isArray(n)){var r=t.observableArray(n);i(n,r),n=r}a(n)})):(a=t.observable(o),s(o));return Object.defineProperty(n,r,{configurable:!0,enumerable:!0,get:a,set:t.isWriteableObservable(a)?function(n){n&&e.isPromise(n)?n.then(function(n){l(a,n,e.isArray(n))}):l(a,n,c)}:void 0}),u[r]=a,a}function u(n,r,o){var a,i={owner:n,deferEvaluation:!0};return"function"==typeof o?i.read=o:("value"in o&&e.error('For defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),"function"!=typeof o.get&&e.error('For defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),i.read=o.get,i.write=o.set),a=t.computed(i),n[r]=a,c(n,r,a)}var d,p=Object.prototype.toString,v=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],f=["remove","removeAll","destroy","destroyAll","replace"],g=["pop","reverse","sort","shift","splice"],b=["push","unshift"],h=Array.prototype,m=t.observableArray.fn,y=!1;return d=function(e,n){var r,o,a;return e?(r=e.__observable__,r&&(o=r[n])?o:(a=e[n],t.isObservable(a)?a:c(e,n,a))):null},d.defineProperty=u,d.convertProperty=c,d.convertObject=s,d.install=function(e){var t=n.binding;n.binding=function(e,n,r){r.applyBindings&&!r.skipConversion&&s(e),t(e,n)},y=e.logConversion},d});